version: "2.4"

services:

  system_manager:
    networks:
      root_net:
        ipv4_address: 192.168.128.2
        ipv6_address: 2001:db8:a::2

  mongo_root:
    networks:
      root_net:
        ipv4_address: 192.168.128.5
        ipv6_address: 2001:db8:a::5
    command: mongod --port 10007 --ipv6
    environment:
      - CLOUD_MONGO_URL=[2001:db8:a::5]
      - CLOUD_SCHEDULER_URL=[2001:db8:a::7]
      - NET_PLUGIN_URL=[2001:db8:a::3]
    #sysctls:
    # - net.ipv6.conf.all.disable_ipv6=0

  mongo_rootnet:
    networks:
      root_net:
        ipv4_address: 192.168.128.4
        ipv6_address: 2001:db8:a::4
    command: mongod --port 10008 --ipv6
    #sysctls:
    # - net.ipv6.conf.all.disable_ipv6=0

  root_service_manager:
    networks:
      root_net:
        ipv4_address: 192.168.128.3
        ipv6_address: 2001:db8:a::3
    #sysctls:
    # - net.ipv6.conf.all.disable_ipv6=0
    environment:
      - SYSTEM_MANAGER_URL=[2001:db8:a::2]
      - CLOUD_MONGO_URL=[2001:db8:a::4]

  redis:
    networks:
      root_net:
        ipv4_address: 192.168.128.8
        ipv6_address: 2001:db8:a::8
    #sysctls:
    # - net.ipv6.conf.all.disable_ipv6=0

  grafana:
    networks:
      root_net:
        ipv4_address: 192.168.128.9
        ipv6_address: 2001:db8:a::9
    #sysctls:
    # - net.ipv6.conf.all.disable_ipv6=0

  dashboard:
    networks:
      root_net:
        ipv4_address: 192.168.128.6
        ipv6_address: 2001:db8:a::6
    #sysctls:
    # - net.ipv6.conf.all.disable_ipv6=0

  cloud_scheduler:
    networks:
      root_net:
        ipv4_address: 192.168.128.7
        ipv6_address: 2001:db8:a::7
    #sysctls:
    # - net.ipv6.conf.all.disable_ipv6=0
    environment:
      - SYSTEM_MANAGER_URL=[2001:db8:a::2]
      - CLOUD_MONGO_URL=[2001:db8:a::5]

networks:
  root_net:
    name: root_net
    enable_ipv6: true
    driver: bridge
    #driver_opts:
    # com.docker.network.enable_ipv6: "true"
    ipam:
      config:
        - subnet: 2001:db8:a::/64
          gateway: 2001:db8:a::1
        - subnet: 192.168.128.0/24
          gateway: 192.168.128.1
