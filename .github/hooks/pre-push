#!/bin/sh

# Temporary stash uncommitted changes to ensure we're only checking committed code
git stash push -q --keep-index

# Perform checks
CHECKS_PASS=true

# black check (will only check, not modify files)
black --check --line-length 100 . || CHECKS_PASS=false

# flake8 check, excluding external
flake8 --config setup.cfg . || CHECKS_PASS=false

# isort check (will only check, not modify files)
isort . --check-only || CHECKS_PASS=false

# Restore uncommitted changes
git stash pop -q

# If any checks failed, exit with non-zero status
if ! $CHECKS_PASS; then
    echo "Pre-push checks failed. Please fix the issues before pushing."
    exit 1
fi

# If we reached here, everything's fine
echo "Pre-push checks passed."
exit 0
